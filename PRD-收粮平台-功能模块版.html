<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRD - 收粮平台（技术对接版）</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700;900&family=LXGW+WenKai:wght@300;400;700&display=swap" rel="stylesheet">
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        forest: { 50:'#f0f7f1', 100:'#d8ecd9', 200:'#b3d9b7', 300:'#7fbf87', 400:'#4a9e56', 500:'#2d7a3a', 600:'#1a5c26', 700:'#1a472a', 800:'#163a23', 900:'#0f2a19' },
        wheat: { 50:'#fdf9ef', 100:'#faf0d4', 200:'#f4dfa8', 300:'#ecc96f', 400:'#d4a843', 500:'#c4922a', 600:'#a87420', 700:'#88571c', 800:'#6f461e', 900:'#5c3b1d' }
      },
      fontFamily: {
        serif: ['"Noto Serif SC"', 'serif'],
        body: ['"LXGW WenKai"', 'sans-serif']
      }
    }
  }
}
</script>
<style>
  * { scroll-behavior: smooth; }
  body { font-family: 'LXGW WenKai', sans-serif; background: #faf6f0; color: #2c2c2c; }
  h1,h2,h3,h4,h5 { font-family: 'Noto Serif SC', serif; }
  .side-nav { position: fixed; left: 0; top: 0; width: 280px; height: 100vh; background: linear-gradient(180deg, #1a472a 0%, #0f2a19 100%); overflow-y: auto; z-index: 50; }
  .side-nav a { display: block; padding: 10px 20px; color: rgba(255,255,255,0.72); text-decoration: none; font-size: 14px; border-left: 3px solid transparent; transition: all 0.2s; }
  .side-nav a:hover, .side-nav a.active { color: #f4dfa8; border-left-color: #d4a843; background: rgba(212,168,67,0.08); }
  .side-nav .nav-title { padding: 24px 20px 8px; font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: rgba(212,168,67,0.6); font-family: 'Noto Serif SC', serif; }
  .main-content { margin-left: 280px; }
  .hero { background: linear-gradient(135deg, #1a472a 0%, #2d7a3a 50%, #1a5c26 100%); position: relative; overflow: hidden; }
  .hero::after { content: '⚙️'; position: absolute; right: 56px; bottom: 28px; font-size: 88px; opacity: 0.14; }
  .card { background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 8px 24px rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.04); }
  .prd-table { width: 100%; border-collapse: separate; border-spacing: 0; border-radius: 12px; overflow: hidden; }
  .prd-table th { background: #1a472a; color: white; padding: 12px 16px; text-align: left; font-weight: 600; font-size: 14px; }
  .prd-table td { padding: 12px 16px; border-bottom: 1px solid #f0ebe3; font-size: 14px; vertical-align: top; }
  .prd-table tr:last-child td { border-bottom: none; }
  .prd-table tr:hover td { background: #fdf9ef; }
  @media (max-width: 1024px) {
    .side-nav { position: static; width: auto; height: auto; }
    .main-content { margin-left: 0; }
  }
</style>
</head>
<body class="antialiased">
<nav class="side-nav">
  <div class="px-5 py-6 border-b border-white/10">
    <div class="text-wheat-400 font-serif text-lg font-bold">🌾 收粮平台</div>
    <div class="text-white/40 text-xs mt-1">PRD V1.0 · 技术对接版</div>
  </div>
  <div class="nav-title">目录</div>
  <a href="#overview">文档目标与边界</a>
  <a href="#terminal-buyer">终端A：收购商小程序</a>
  <a href="#terminal-farmer">终端B：农户小程序</a>
  <a href="#terminal-pc">终端C：PC 收银台</a>
  <a href="#terminal-bank-h5">终端D：银行 App 跳转 H5</a>
  <a href="#terminal-admin">终端E：H5 管理端</a>
  <a href="#cross-model">跨终端数据模型</a>
  <a href="#cross-state">跨终端状态机与参数</a>
  <a href="#integration">技术对接清单</a>
  <a href="#scope">MVP 与后续</a>
  <div class="nav-title">主文档</div>
  <a href="./PRD-收粮平台-可视化.html">返回可视化 PRD</a>
</nav>

<div class="main-content">
  <section class="hero px-8 py-14 md:px-16 md:py-20">
    <div class="max-w-4xl relative z-10">
      <div class="inline-block px-4 py-1.5 bg-wheat-400/20 text-wheat-300 rounded-full text-sm font-semibold mb-6 border border-wheat-400/20">
        面向技术评审 · 按终端拆分
      </div>
      <h1 class="text-4xl md:text-5xl font-serif font-black text-white leading-tight mb-4">
        收粮平台<br><span class="text-wheat-400">功能模块与逻辑说明</span>
      </h1>
      <p class="text-white/75 text-lg leading-relaxed max-w-3xl">
        本文档只描述功能能力、业务逻辑、状态规则和技术对接边界，不包含原型页面链接与视觉说明。
      </p>
    </div>
  </section>

  <div class="max-w-6xl mx-auto px-6 md:px-12 py-12">
    <section id="overview" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">1</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">文档目标与边界</h2>
      </div>
      <div class="card p-6">
        <div class="space-y-2 text-sm text-gray-700">
          <div>• 目标：给技术团队明确每个终端的模块功能、关键流程、状态流转、参数约定和接口边界。</div>
          <div>• 边界：只覆盖 MVP 范围内已确定功能，不展开 UI 实现细节和非 MVP 增强项。</div>
          <div>• 对接原则：同一业务实体在不同终端口径一致；状态机一致；错误码与文案口径一致。</div>
        </div>
      </div>
    </section>

    <section id="terminal-buyer" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">2</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">终端A：收购商小程序</h2>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>模块</th>
              <th>核心功能</th>
              <th>核心逻辑</th>
              <th>关键规则</th>
              <th>异常与兜底</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">首页</td>
              <td>经营总览、快捷入口、我发布需求</td>
              <td>按当日/本月/本年聚合金额与笔数；双列表读取需求数据并按时间排序</td>
              <td>MVP 不展示趋势图与品类占比图；“我发布”卡片不显示距离</td>
              <td>数据为空展示空态占位，不阻断页面主流程</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">市场</td>
              <td>搜索、筛选、联系、发布求购</td>
              <td>仅展示农户发布的销售需求；筛选后本地组合条件再排序输出</td>
              <td>筛选维度含时间/品类/距离/排序；关键词入口与“我关注”筛选为 MVP 隐藏</td>
              <td>无结果显示空态并支持一键清空筛选</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">发布求购</td>
              <td>新建、编辑、只读查看</td>
              <td>提交后写入需求模型并回流到首页、市场、需求管理</td>
              <td>支持 `mode=edit|view`；`view` 为只读态不可提交；发布地址为必填并支持定位回填</td>
              <td>字段校验失败阻止提交并定位错误字段</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">需求管理</td>
              <td>进行中管理、已下架查看</td>
              <td>进行中可编辑或下架；下架后转历史分组</td>
              <td>进行中进入编辑态；已下架进入只读态</td>
              <td>状态冲突时以后端最新状态为准并提示“状态已变化”</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">开单</td>
              <td>明细开单、快捷开单、扫码、合作农户选择</td>
              <td>明细模式按商品累计金额；快捷模式直接以总额生成订单草稿</td>
              <td>底部弹层必须互斥；同一时刻只允许一个弹层打开</td>
              <td>扫码失败、商户不存在、金额非法需即时阻断并提示</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">合作农户</td>
              <td>合作农户搜索、合作关系展示、开单场景选择</td>
              <td>只读取与当前收购商存在支付/交易关系的农户；支持姓名/手机号/卡号/银行本地搜索</td>
              <td>不开放手工新增农户（风险控制）；普通浏览态不展示“去开单”按钮</td>
              <td>无历史合作数据时展示空态并提示“完成首笔付款后自动累计”</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">收银台</td>
              <td>支付方式选择、支付确认、结果回跳</td>
              <td>支付发起后进入支付中，回调成功/失败更新订单状态</td>
              <td>支付方式：行业支付 → 订单付；30 分钟超时自动取消</td>
              <td>失败允许重试；超时后不可继续支付，仅可重开单</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">订单</td>
              <td>状态筛选、继续支付、订单详情</td>
              <td>列表按状态+时间筛选；详情按订单快照展示</td>
              <td>待支付详情不展示支付方式；超时文案与收银台一致</td>
              <td>订单不存在或无权限时返回列表并提示</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">我的</td>
              <td>个人信息、邀请农户、通知、设置入口</td>
              <td>个人信息只读；邀请农户通过二维码外发到入驻页；消息按业务事件落库/推送</td>
              <td>二维码默认落地 <code>buyer-farmer-add.html?source=invite</code>；修改主体资料需走线下或管理端审核流程</td>
              <td>通知读取失败不影响主业务交易链路</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="terminal-farmer" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">3</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">终端B：农户小程序</h2>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>模块</th>
              <th>核心功能</th>
              <th>核心逻辑</th>
              <th>关键规则</th>
              <th>异常与兜底</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">首页</td>
              <td>收款总览、快捷入口、我发布需求</td>
              <td>与收购商首页同骨架，便于双端认知统一</td>
              <td>卡片状态文案统一“进行中”；从详情返回需回原来源页</td>
              <td>空数据时展示“去发布销售需求”引导</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">市场</td>
              <td>查看收购商求购需求、搜索筛选、联系</td>
              <td>只看收购商需求；“只看关注/关键词”能力当前为 MVP 隐藏</td>
              <td>筛选维度与收购商端保持一致，避免双端口径分裂</td>
              <td>联系方式不可用时展示备用联系引导</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">发布销售</td>
              <td>发布销售需求、编辑销售需求</td>
              <td>字段聚焦交易核心信息，提交后进入需求管理</td>
              <td>字段口径：销售标题（必填）、描述（选填）、发布地址（必填）、销售数量（必填）、销售单价（选填）</td>
              <td>价格、数量非法值直接拦截</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">销售需求管理</td>
              <td>进行中/已下架管理</td>
              <td>进行中可编辑；已下架仅只读查看</td>
              <td>状态判断规则与收购商端一致（避免一端可编辑一端只读冲突）</td>
              <td>并发更新以服务端状态为准并提示刷新</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">收款综合页</td>
              <td>收款码、结算卡信息、收款记录入口</td>
              <td>收款码固定绑定当前农户账户，记录与订单支付成功数据关联</td>
              <td>页面入口和返回链路稳定，不允许错误跳转到无权限路径</td>
              <td>收款码加载失败时可重试，结算信息异常时提示联系客服</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">收款记录与详情</td>
              <td>查看已到账记录和单笔详情</td>
              <td>仅读取支付成功订单并按时间倒序</td>
              <td>详情展示付款方、订单信息、支付方式、到账时间</td>
              <td>记录为空时保持页面可用并展示引导文案</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">我的</td>
              <td>个人资料、通知、反馈</td>
              <td>资料字段模板固定，值为农户主体信息</td>
              <td>资料仅查看不可直接改，需管理端流程变更</td>
              <td>通知接口失败不影响收款与市场操作</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="terminal-pc" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">4</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">终端C：PC 收银台（H5）</h2>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>模块</th>
              <th>核心功能</th>
              <th>技术逻辑</th>
              <th>规则</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">订单加载</td>
              <td>展示订单金额、收款方、支付限时信息</td>
              <td>通过订单号拉取订单快照并校验状态是否可支付</td>
              <td>非待支付状态不允许再次发起支付</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">支付方式</td>
              <td>行业支付、订单付</td>
              <td>默认选中行业支付；切换后写入支付请求参数</td>
              <td>顺序固定：行业支付 → 订单付（无数字人民币）</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">支付结果</td>
              <td>成功/失败/取消/超时状态展示</td>
              <td>依赖支付回调更新订单状态并轮询结果</td>
              <td>PC 收银台有效期 10 天；失败可重试，超时后不可继续支付</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">订单付引导</td>
              <td>企业网银支付指引</td>
              <td>收银台仅提示“订单已发起，请企业登录网银完成支付”</td>
              <td>不在收银台页面内直接执行订单付扣款</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">演示预设</td>
              <td>切换演示场景</td>
              <td>悬浮入口触发本地状态模拟，不影响真实接口定义</td>
              <td>仅用于演示，不进入生产逻辑</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="terminal-bank-h5" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">5</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">终端D：银行 App 跳转 H5</h2>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>模块</th>
              <th>核心功能</th>
              <th>核心逻辑</th>
              <th>规则</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">订单承接</td>
              <td>展示订单号、金额、付款方、收款方信息</td>
              <td>通过 URL 参数承接上游订单快照并进行页面渲染</td>
              <td>字段缺失时使用安全默认值并提示用户核验</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">确认付款</td>
              <td>银行 App 内发起付款</td>
              <td>点击“确认付款”进入处理态，成功后回跳上游页面</td>
              <td>按钮防重复点击，处理完成后统一提示</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">回跳策略</td>
              <td>支付完成后返回来源页</td>
              <td>当前原型使用 <code>history.back()</code> 模拟回跳</td>
              <td>生产环境需由回调地址 + 订单状态查询联动保证一致性</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="terminal-admin" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">7</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">终端E：H5 管理端（网点客户经理）</h2>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>模块</th>
              <th>核心功能</th>
              <th>核心逻辑</th>
              <th>规则</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">开户申请</td>
              <td>为收购商/农户录入主体信息并提交</td>
              <td>证照识别 + 字段补全 + 审核流转</td>
              <td>手机号、证件号需唯一校验；敏感信息落库前加密</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">申请记录</td>
              <td>按状态与角色查询开户记录</td>
              <td>条件筛选 + 时间排序 + 详情查看</td>
              <td>审核状态机需可追溯，保留操作日志</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">用户信息查询</td>
              <td>查询已开户主体信息</td>
              <td>支持名称/手机号检索，查看角色差异化字段</td>
              <td>只读展示，不直接修改核心主体资料</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">数据看板</td>
              <td>发展、交易、品类三类统计</td>
              <td>按日/月/年聚合并支持趋势展示</td>
              <td>统计口径与交易库一致，禁止前端二次口径改写</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="cross-model" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">6</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">跨终端数据模型</h2>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>实体</th>
              <th>核心字段</th>
              <th>说明</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">用户主体</td>
              <td>userId、role、name、mobile、status、settlementInfo</td>
              <td>收购商与农户统一主体模型，角色差异通过扩展字段表达</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">需求</td>
              <td>demandId、publisherRole、category、quantity、unitPrice、status、publishTime</td>
              <td>状态仅含 active/closed；市场只读 active</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">订单</td>
              <td>orderId、buyerId、farmerId、amount、payMethod、status、createdAt、expireAt</td>
              <td>订单为支付主实体，状态由支付回调与超时任务共同驱动</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">关键词订阅（预留）</td>
              <td>keywordId、userId、keyword、enabled、updatedAt</td>
              <td>MVP 不开放前台入口；后续版本用于关注匹配与个性化通知</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">合作农户关系</td>
              <td>relationId、buyerId、farmerId、payCount、lastPayAt、source</td>
              <td>由支付成功事件驱动累计；仅系统自动沉淀关系，不支持收购商手工新增</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="cross-state" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">8</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">跨终端状态机与参数约定</h2>
      </div>
      <div class="grid md:grid-cols-2 gap-4 mb-4">
        <div class="card p-5">
          <h4 class="font-serif font-bold text-forest-800 mb-3">订单状态机</h4>
          <div class="space-y-2 text-sm text-gray-700">
            <div>• 待支付 → 支付中 → 支付成功/支付失败</div>
            <div>• 小程序待支付超过 30 分钟自动流转为已取消；PC 收银台有效期按 10 天口径展示</div>
            <div>• 支付失败可回到待支付并重试</div>
            <div>• 任何终端均不得绕过状态机直接改状态</div>
          </div>
        </div>
        <div class="card p-5">
          <h4 class="font-serif font-bold text-forest-800 mb-3">需求状态机</h4>
          <div class="space-y-2 text-sm text-gray-700">
            <div>• active（进行中）↔ closed（已下架）</div>
            <div>• 市场只读 active，管理页展示 active+closed</div>
            <div>• closed 需求默认只读，不可再编辑发布</div>
            <div>• 状态变更后需广播更新首页/市场/管理列表</div>
          </div>
        </div>
      </div>
      <div class="card overflow-hidden">
        <table class="prd-table">
          <thead>
            <tr>
              <th>参数</th>
              <th>示例</th>
              <th>用途</th>
              <th>约束</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">source</td>
              <td>home / market / manage</td>
              <td>定义详情返回路径</td>
              <td>缺失时回默认列表页</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">mode</td>
              <td>edit / view</td>
              <td>控制发布页编辑态或只读态</td>
              <td>view 模式必须禁用提交动作</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">from</td>
              <td>manage</td>
              <td>标识入口上下文</td>
              <td>仅用于路由回跳，不参与业务计算</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section id="integration" class="mb-14">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">9</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">技术对接清单</h2>
      </div>
      <div class="card overflow-hidden mb-4">
        <table class="prd-table">
          <thead>
            <tr>
              <th>对接域</th>
              <th>接口职责</th>
              <th>幂等/一致性要求</th>
              <th>日志与监控</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="font-medium text-forest-700">需求服务</td>
              <td>发布、编辑、下架、查询、筛选</td>
              <td>编辑与下架需版本校验，防并发覆盖</td>
              <td>记录状态变更前后值、操作者、时间</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">订单服务</td>
              <td>开单、查询、状态更新、超时处理</td>
              <td>状态流转必须单向合法，禁止逆向跳变</td>
              <td>监控超时任务执行率与失败重试率</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">支付服务</td>
              <td>支付发起、回调验签、结果落库</td>
              <td>回调幂等（同订单同流水仅生效一次）</td>
              <td>监控成功率、时延、回调失败率</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">账户服务</td>
              <td>主体信息、结算信息、权限校验</td>
              <td>敏感字段加密存储、脱敏展示</td>
              <td>审计访问日志与数据脱敏链路</td>
            </tr>
            <tr>
              <td class="font-medium text-forest-700">通知服务</td>
              <td>订单结果、需求状态变更、系统通知</td>
              <td>同一事件去重投递，失败可补偿</td>
              <td>监控发送成功率与重试队列积压</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="card p-5 bg-blue-50 border border-blue-200 text-sm text-blue-700">
        建议联调顺序：1) 需求服务与账户权限 → 2) 订单服务 → 3) 支付回调与超时任务 → 4) 通知与看板统计。
      </div>
    </section>

    <section id="scope" class="mb-16">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-10 h-10 bg-forest-700 rounded-xl flex items-center justify-center text-white">10</div>
        <h2 class="text-2xl font-serif font-bold text-forest-800">MVP 与后续</h2>
      </div>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="card p-5 border-l-4 border-l-green-600">
          <h4 class="font-serif font-bold text-forest-800 mb-3">MVP 必做</h4>
          <div class="space-y-2 text-sm text-gray-600">
            <div>• 双端供需发布与市场匹配</div>
            <div>• 收购商开单与双端支付链路闭环</div>
            <div>• 农户收款记录与详情可回溯</div>
            <div>• 管理端开户、查询、基础看板</div>
          </div>
        </div>
        <div class="card p-5 border-l-4 border-l-wheat-600">
          <h4 class="font-serif font-bold text-forest-800 mb-3">后续增强</h4>
          <div class="space-y-2 text-sm text-gray-600">
            <div>• 收购商首页高级数据洞察</div>
            <div>• 关键词智能订阅策略</div>
            <div>• 看板导出与异常预警</div>
            <div>• 全量替换 mock 数据为生产数据链路</div>
          </div>
        </div>
      </div>
    </section>

    <footer class="text-center py-8 text-sm text-gray-400 border-t border-gray-200">
      <p>收粮平台 · 技术对接版 PRD</p>
      <p class="mt-1">更新时间：2026-02-27 · 终端拆分 + 页面级口径同步 + 对接清单</p>
    </footer>
  </div>
</div>

<script>
  const navLinks = document.querySelectorAll('.side-nav a[href^="#"]');
  const sections = [];
  navLinks.forEach(link => {
    const id = link.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if (el) sections.push({ el, link });
  });
  function updateActiveNav() {
    const scrollY = window.scrollY + 120;
    let current = sections[0];
    for (const s of sections) {
      if (s.el.offsetTop <= scrollY) current = s;
    }
    navLinks.forEach(l => l.classList.remove('active'));
    if (current) current.link.classList.add('active');
  }
  window.addEventListener('scroll', updateActiveNav);
  updateActiveNav();
</script>
</body>
</html>
