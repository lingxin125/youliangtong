<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>邮粮通 - 数据看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="shared.js"></script>
    <style>
        .postal-bg { background: #F5F7FA; }

        .data-tab {
            padding: 8px 16px;
            font-size: 13px;
            color: #666;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            background: #fff;
            border: 1px solid #E8E8E8;
        }
        .data-tab.active {
            background: #11A64A;
            color: #fff;
            border-color: #11A64A;
        }

        .stat-card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.04);
        }
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
            font-family: Poppins, sans-serif;
        }
        .stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .data-panel {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .panel-title {
            font-size: 14px;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
    </style>
</head>
<body>
<div class="mobile-container postal-bg">
    <div id="statusBar"></div>
    <div id="navBar"></div>

    <div class="flex-1 overflow-y-auto no-scrollbar px-4 pb-4" style="padding-bottom:80px;">

        <div class="flex gap-2 mt-3 overflow-x-auto no-scrollbar">
            <div class="data-tab active" onclick="switchTab('dev', this)">发展情况</div>
            <div class="data-tab" onclick="switchTab('trade', this)">交易情况</div>
            <div class="data-tab" onclick="switchTab('cat', this)">品类情况</div>
        </div>

        <div id="panel-dev" class="tab-panel active mt-4">
            <div class="data-panel mb-3">
                <div class="panel-title">新增客户</div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="stat-card">
                        <div class="stat-value">3</div>
                        <div class="stat-label">今日</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">28</div>
                        <div class="stat-label">本月</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">156</div>
                        <div class="stat-label">累计</div>
                    </div>
                </div>
            </div>

            <div class="data-panel mb-3">
                <div class="panel-title">客户总量</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="stat-card">
                        <div class="stat-value">156</div>
                        <div class="stat-label">收购商</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2,847</div>
                        <div class="stat-label">农户</div>
                    </div>
                </div>
            </div>

            <div class="data-panel">
                <div class="panel-title">月度发展趋势</div>
                <div id="devChart" style="width:100%;height:200px;"></div>
            </div>
        </div>

        <div id="panel-trade" class="tab-panel mt-4">
            <div class="data-panel mb-3">
                <div class="panel-title">收购笔数</div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="stat-card">
                        <div class="stat-value">86</div>
                        <div class="stat-label">今日</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">1,245</div>
                        <div class="stat-label">本月</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12,580</div>
                        <div class="stat-label">累计</div>
                    </div>
                </div>
            </div>

            <div class="data-panel mb-3">
                <div class="panel-title">收购金额</div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="stat-card">
                        <div class="stat-value">28.6万</div>
                        <div class="stat-label">今日</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">386.5万</div>
                        <div class="stat-label">本月</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2,458万</div>
                        <div class="stat-label">累计</div>
                    </div>
                </div>
            </div>

            <div class="data-panel">
                <div class="panel-title">月度交易趋势</div>
                <div id="tradeChart" style="width:100%;height:200px;"></div>
            </div>
        </div>

        <div id="panel-cat" class="tab-panel mt-4">
            <div class="data-panel mb-3">
                <div class="panel-title">品类收购占比</div>
                <div id="catChart" style="width:100%;height:220px;"></div>
            </div>

            <div class="data-panel">
                <div class="panel-title">品类明细</div>
                <div class="space-y-3 mt-3" id="catList"></div>
            </div>
        </div>

    </div>

    <div id="tabBar"></div>
</div>

<script>
document.getElementById('statusBar').innerHTML = renderStatusBar();
document.getElementById('navBar').innerHTML = renderHeader('数据看板');
document.getElementById('tabBar').innerHTML = renderManagerTabBar('data');

function renderManagerTabBar(active) {
    var tabs = [
        { id: 'home', icon: 'fa-house', label: '首页', href: 'manager-home.html' },
        { id: 'data', icon: 'fa-chart-pie', label: '数据', href: 'manager-dashboard.html' }
    ];

    var items = tabs.map(function(t) {
        var isActive = t.id === active;
        var colorClass = isActive ? 'text-primary' : 'text-gray-400';
        return '<a href="' + t.href + '" class="flex-1 flex flex-col items-center py-2 no-underline" style="text-decoration:none;">' +
            '<i class="fas ' + t.icon + ' ' + colorClass + ' text-lg mb-0.5"></i>' +
            '<span class="text-[11px] ' + colorClass + '">' + t.label + '</span>' +
        '</a>';
    }).join('');

    return '<div class="bg-white border-t border-gray-100 flex" style="padding-bottom:env(safe-area-inset-bottom);">' + items + '</div>';
}

function switchTab(tab, el) {
    document.querySelectorAll('.data-tab').forEach(item => item.classList.remove('active'));
    el.classList.add('active');

    document.getElementById('panel-dev').style.display = tab === 'dev' ? 'block' : 'none';
    document.getElementById('panel-trade').style.display = tab === 'trade' ? 'block' : 'none';
    document.getElementById('panel-cat').style.display = tab === 'cat' ? 'block' : 'none';

    setTimeout(() => {
        devChart.resize();
        tradeChart.resize();
        catChart.resize();
    }, 50);
}

const devChart = echarts.init(document.getElementById('devChart'));
const tradeChart = echarts.init(document.getElementById('tradeChart'));
const catChart = echarts.init(document.getElementById('catChart'));

const monthLabels = ['3月','4月','5月','6月','7月','8月','9月','10月','11月','12月','1月','2月'];

devChart.setOption({
    tooltip: { trigger: 'axis' },
    grid: { left: 36, right: 8, top: 16, bottom: 24 },
    xAxis: { type: 'category', data: monthLabels, axisLabel: { fontSize: 10, color: '#9CA3AF' }, axisLine: { show: false }, axisTick: { show: false } },
    yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#9CA3AF' }, splitLine: { lineStyle: { color: 'rgba(0,0,0,0.04)' } } },
    series: [
        { name: '收购商', type: 'bar', data: [8, 10, 9, 11, 13, 12, 14, 15, 12, 16, 18, 19], barWidth: 6, itemStyle: { color: '#3B82F6', borderRadius: [3,3,0,0] } },
        { name: '农户', type: 'bar', data: [56, 62, 71, 88, 95, 102, 116, 121, 133, 141, 152, 168], barWidth: 6, itemStyle: { color: '#11A64A', borderRadius: [3,3,0,0] } }
    ]
});

tradeChart.setOption({
    tooltip: { trigger: 'axis' },
    grid: { left: 36, right: 8, top: 16, bottom: 24 },
    xAxis: { type: 'category', data: monthLabels, axisLabel: { fontSize: 10, color: '#9CA3AF' }, axisLine: { show: false }, axisTick: { show: false } },
    yAxis: { type: 'value', axisLabel: { fontSize: 10, color: '#9CA3AF' }, splitLine: { lineStyle: { color: 'rgba(0,0,0,0.04)' } } },
    series: [{
        name: '金额(万元)',
        type: 'bar',
        data: [168, 190, 205, 214, 238, 259, 272, 301, 318, 339, 362, 386],
        barWidth: 12,
        itemStyle: { borderRadius: [4,4,0,0], color: new echarts.graphic.LinearGradient(0,0,0,1,[{ offset:0, color:'#11A64A' }, { offset:1, color:'#4CAF50' }]) }
    }]
});

catChart.setOption({
    tooltip: { trigger: 'item', formatter: '{b}: {d}%' },
    legend: { bottom: 0, textStyle: { fontSize: 10, color: '#6B7280' } },
    series: [{
        type: 'pie',
        radius: ['40%', '60%'],
        center: ['50%', '42%'],
        label: { fontSize: 10, formatter: '{b} {d}%' },
        data: [
            { name: '水果', value: 32, itemStyle: { color: '#EF4444' } },
            { name: '蔬菜', value: 28, itemStyle: { color: '#22C55E' } },
            { name: '粮食', value: 22, itemStyle: { color: '#F59E0B' } },
            { name: '禽蛋', value: 8, itemStyle: { color: '#8B5CF6' } },
            { name: '肉类', value: 6, itemStyle: { color: '#F97316' } },
            { name: '其他', value: 4, itemStyle: { color: '#9CA3AF' } }
        ]
    }]
});

const catData = [
    { name: '水果', value: 32, color: '#EF4444', merchants: 68, day: '¥8.2万', month: '¥126万' },
    { name: '蔬菜', value: 28, color: '#22C55E', merchants: 52, day: '¥12.5万', month: '¥168万' },
    { name: '粮食', value: 22, color: '#F59E0B', merchants: 36, day: '¥7.9万', month: '¥92.5万' },
    { name: '禽蛋', value: 8, color: '#8B5CF6', merchants: 24, day: '¥2.4万', month: '¥32万' },
    { name: '肉类', value: 6, color: '#F97316', merchants: 18, day: '¥1.8万', month: '¥26万' },
    { name: '其他', value: 4, color: '#9CA3AF', merchants: 11, day: '¥1.2万', month: '¥15万' }
];

document.getElementById('catList').innerHTML = catData.map(item => `
    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full" style="background:${item.color}"></span>
            <span class="text-sm font-medium text-gray-800">${item.name}</span>
        </div>
        <div class="text-xs text-gray-500">${item.merchants}户 · ${item.month}</div>
    </div>
`).join('');
</script>
</body>
</html>
